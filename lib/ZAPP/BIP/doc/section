#
# 协议描述：
#
从2012-10-01 ~ 2013-09-31 周期内
0 - 100万 %3, 100 - 200万 %2， 200 - 99999999999999万 %1; 按分段计费
保底5万， 封顶20万



#
# 规则设置
#
规则组1 => {
    dir     => 1,  # 入金交易
    rules   => [
        {
            ack     => 2,   # 周期确认
            dir     => 2,   # 付银行手续费
            sect    => [
                {
                    begin   => 0,
                    end     => 999999999999999999,
                    mode    => 1,                     # 按比例
                    ratio   => 3%,                    
                },
            ],
            ack_id  => 确认规则1,                     # 确认规则ID
        }
    ]
}


确认规则1 => {
    ack_period  => [
        {
            begin   => 2012-10-01,
            end     => 2013-10-01,
            ceiling => 20万,        # 暂估手续费封顶
            floor   => 5万,         # 暂估手续费保底
        }
    ],
    ack_type    => 3, # 1 包周期(月，年); 2 阶梯; 3 分段
    ack_sect    => [
        {
            begin   => 0,
            end     => 3,
            ratio   => 1,       # 不打折
        },
        {
            begin   => 3,
            end     => 6,
            ratio   => 2/3,     # 2/3
        },
        {
            begin   => 6,
            end     => 999999999999,    # 正无穷
            ratio   => 1/3,     # 1/3
        },
    ],
    hf          => {},
}



#
# 算法描述
#
假设：  周期内交易额 1000万


一、暂估阶段
按单笔3%算暂估手续费，且入暂估手续费账薄

二、确认阶段
1. 根据所传入的周期 2013-09-01 与 确认规则1, 此日期或者此日期前的某一天要达到我们此确认规则的某一确认周期的最后一天，我们开始确认，并且汇总出此确认规则与周期的暂估手续费。
2. 判断确认类型ack_type, 如果为3 分段, 执行下步
3. 看暂估手续费到达计算区间， 假设我们的暂估手续费是30万(按之前逐笔3%算，我们交易金额是1000万)，我们能确认我们达到了第3个计算区间，也就是暂估手续费6万到正无穷.
4. 按照第1个计算区间 到 第3个计算区间循环， 
   循环1 ： 
        暂估手续费 = 30万暂估手续费 - 第1计算区间的end - begin值3万, 结果剩下27万； 实际总手续费 += 3万 * 1(打折比例)  结果： 3万
   循环2 :
        暂估手续费 = 27万暂估手续费 - 第2计算区间的end - begin值3万, 结果剩下24万； 实际总手续费 += 3万 * 2/3(打折比例) 结果： 5万
   最后循环：
        实际总手续费 += 24万 * 1/3(打折比例) 结果： 13万

5. 根据以上算出的总手续费， 小于保底5万，大于封顶20万，否则为实际值，我们这里是13万。
