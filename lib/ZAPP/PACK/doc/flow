账务系统确认流程



后台服务
1. 接收到前台发送的确认规则id, 与扫描日期, 确认控制表是否存在该记录(主键: 确认规则id 与 扫描日期)，不存在插入记录（1 可开始确认）,创建新进程执行2操作，响应界面请求
2. 创建新进程
    a  如果为可开始确认 或 导出文件失败，那么 (暂估手续费科目指定确认规则按交易日期分类汇总作为输入)调用计费系统返回 实际总额，打折比例，确认周期
        a1  如果没有返回确认周期，那么控制表修改为(-1 未达确认周期状态),停止整个处理; 否则继续执行以下流程。
        a2  导出一个sql语句查询出来的内容(指定确认规则id按各核算项分类汇总暂估手续费, 进行分摊，并且算出ark0)
        a3  将控制表状态改为(2 导出文件成功), 继续执行以下流程; 否则为(-2 导出文件失败), 停止整个处理。
    b  生成load_mission, 将控制表状态更新为(3 确认中); 如果生成load_mission失败，将控制表状态更新为(-3 确认失败),那么停止整个处理。
    c  向系统发凭证导入命令(分配，导入)
    d  不断循环确认确认状态
        d1 如果mission状态为成功， 那么更新为(4 确认成功)
        d2 如果mission状态为失败， 那么更新为(-3 确认失败)



控制界面
1. 确认控制界面可以看到是否已经确认成功.
2. 确认控制界面如果是 
   可开始确认(1)(简称: 可开始)                 => (只有确认按钮)点确认 => 调用后台服务
   导出文件成功(2)(简称: 导出成功)             => (只有确认按钮)点确认 => 调用后台服务
   确认中(3)(简称: 确认中)                     => 没有按钮
   确认成功(4)(简称: 确认成功)                 => 没有按钮
   未达确认周期状态(-1)(简称: 未达确认周期)    => 只有删除按钮         => 点删除可以删除该记录
   导出文件失败(-2)(简称: 导出失败)            => (只有确认按钮)点确认 => 调用后台服务
   确认失败(-3)(简称: 确认失败)                => (只有确认按钮)点确认 => 调用后台服务
