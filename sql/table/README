1、名词缩写
    yhys         : 已核应收
    yhyf         : 已核应付
    yfbf         : 应付备付
    yfzy         : 应付自有
    fee          : 手续费
    bamt         : 银行款
    bfee         : 银行手续费
    cfee         : 客户手续费
    yp           : 易宝
    zyzj         : 自有资金
    jrjg         : 金融机构
    bfj          : 备付金
    txamt        : 交易金额
    bsc          : 银行短款
    blc          : 银行长款
    dqhf         : 定期划付
    dfss         : 垫付损失
    zhlx         : 账户利息
    dqr          : 待确认
    dgd          : 待勾兑
    cust         : 客户
    acct         : 账户
    fee          : 手续费
    cost         : 成本
    income       : 收入
    deposit      : 存款
    c            : 客户(id,)
    p            : 产品(id,)
    e            : 差错
    tx           : 交易
    zjbd         : 资金变动

2、核算项
    c            : 客户id
    p            : 产品id
    bi           : 银行接口编号
    period       : 期间日期
    e_date       : 差错日期
    tx_date      : 交易日期
    wlzj_type    : 往来资金类型
    zjbd_type    : 资金变动类型
    zyzj_acct    : 自有资金账号

3、账簿名称
   book_bamt_yhyf   : 已核应付银行款
   book_bamt_yhys   :
   book_bfee_cwwf
   book_bfee_yhyf
   book_bfee_yhys
   book_bfj_cust
   book_blc
   book_blc_zyzj
   book_bsc
   book_bsc_zyzj
   book_cfee_dqhf
   book_cost_bfee
   book_cost_dfss
   book_deposit_bfj
   book_deposit_zyzj
   book_fee_jrjg
   book_income_cfee
   book_income_zhlx
   book_txamt_dgd
   book_txamt_dqr
   book_txamt_yhyf
   book_txamt_yhys
   book_wlzj_yfbf
   book_wlzj_yfzy
   book_wlzj_ysbf
   book_wlzj_yszy

4、账簿设计约束
  
   4.1、 账簿字段约束

   4.1.1、第一个字段是id
   4.1.2、接下来是: 若干个核算项， 
   4.1.3、接下来是: j(借方发生额), d(贷方发生额)
   4.1.4、接下来是: ys_type(原始凭证类型), ys_id(原始凭证id), jzpz_id(记账凭证id)
   4.1.5、接下来是: ts_c(创建日期)

   4.2、核算项:
   
   4.2.1、枚举类型的核算项 

          取值空间较小， 如产品类型，备付金银行账号, 
          这些字段基本都有相关的核算项字典表描述, 所以在账簿中,基本用int类型 

   4.2.2、日期类型核算项

          如差错日期e_date, 期间日期period, 直接用date数据类型
 
   4.2.3、大维度核算项

          如客户编号， 直接用客户编号的字面值， 不另建字典表关联

   4.2、账簿模板

        -- 
        -- 应付银行 - 已核应付银行款 
        --
        drop table book_bamt_yhyf;
        create table book_bamt_yhyf (
              -- 主键
              id          bigint primary key not null,
    
              -- 核算项字段
              zyzj_acct   integer  not null,
              zjbd_type   integer  not null,
              zjbd_date   date     not null,

              -- 通用维度(分区)
              period      date not null,
    
              -- 记账数据
              j  bigint default 0 not null,
              d  bigint default 0 not null,

              -- 记账凭证关联数据
              ys_type     char(4)      not null,
              ys_id       bigint       not null,
              jzpz_id     bigint       not null,
    
              -- 创建时间戳
              ts_c	timestamp default current timestamp
        );

        -- id序列
        drop sequence seq_bamt_yhyf;
        create sequence seq_bamt_yhyf as bigint start with 1 increment by 1 minvalue 1 no maxvalue no cycle cache 200 order;

        -- MQT表
        create table sum_bamt_yhyf as (
            select zyzj_acct  as zyzj_acct,
        	   zjbd_type  as zjbd_type,
        	   zjbd_date  as zjbd_date,
        	   period     as period,
           	   sum(j)     as j,
	           sum(d)     as d,
        	   count(*)   as cnt
            from book_bamt_yhyf
            group by zyzj_acct, zjbd_type, zjbd_date, period
        )
        data initially deferred refresh immediate
        in tbs_dat;

        -- integrity unchecked
        set integrity for sum_bamt_yhyf materialized query immediate unchecked;

5、原始凭证表设计约束

    5.1、字段约束
    5.1.1、原始凭证编号id
    5.1.2、处理状态 status   
    5.1.3、期间日期 period
    5.1.4、--------其他字段--------
    5.1.5、撤销标志 flag
    5.1.6、撤销原因 revoke_user
    5.1.7、撤销用户 

drop table yspz_temp;
create table yspz_temp (
-- id
-- 处理状态
    id                   bigint primary key not null,
    status               char(1) not null,

--- tp  : 
    period               date       not null,

-- revoke-concerned
    flag                 char(1),
    revoke_cause         varchar(512),
    revoke_user          int,
    ts_revoke            timestamp,
--
    memo                 varchar(512),
    ts_c                 timestamp  default current timestamp

) in tbs_dat index in tbs_idx;


    5.2、
    5.3、
    5.4、
    5.5、
